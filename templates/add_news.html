<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить новость - Панель администратора</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; background-color: #f8f9fa; color: #333; }
        .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: 240px; background-color: #1e3a8a; color: white; padding-top: 20px; }
        .sidebar h2 { text-align: center; color: white; margin-bottom: 2rem; }
        .sidebar a { display: block; color: white; padding: 15px 20px; text-decoration: none; transition: background-color 0.3s; }
        .sidebar a:hover, .sidebar a.active { background-color: #3b82f6; }
        .main-content { margin-left: 240px; padding: 2rem; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding-bottom: 1rem; margin-bottom: 2rem; }
        .logout-btn { background: #d9534f; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; }
        .logout-btn:hover { background: #c9302c; }
        .form-container { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input[type="text"], textarea { width: 100%; padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-family: inherit; font-size: 1rem; }
        textarea { resize: vertical; min-height: 200px; }
        .submit-btn { background: #5cb85c; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        .submit-btn:hover { background: #4cae4c; }
        .status-message { margin-top: 1rem; padding: 10px; border-radius: 4px; display: none; }
        .status-message.success { background-color: #dff0d8; color: #3c763d; }
        .status-message.error { background-color: #f2dede; color: #a94442; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Админ-панель</h2>
        <a href="/admin/dashboard.html">Главная</a>
        <a href="/admin/applications.html">Просмотр заявок</a>
        <a href="/admin/add_news.html" class="active">Добавить новость</a>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>Добавить новость</h1>
            <form action="/logout" method="post">
                <button type="submit" class="logout-btn">Выйти</button>
            </form>
        </div>
        <div class="form-container">
            <form id="add-news-form">
                <div class="form-group">
                    <label for="title">Заголовок:</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="content">Содержание:</label>
                    <textarea id="content" name="content" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Опубликовать</button>
            </form>
            <div id="status-message" class="status-message"></div>
        </div>
    </div>

    <script>
        document.getElementById('add-news-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const statusMessage = document.getElementById('status-message');

            statusMessage.style.display = 'none';

            if (!title || !content) {
                statusMessage.textContent = 'Заголовок и содержание не могут быть пустыми.';
                statusMessage.className = 'status-message error';
                statusMessage.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/admin/api/news', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, content })
                });

                if (response.ok) {
                    statusMessage.textContent = 'Новость успешно добавлена!';
                    statusMessage.className = 'status-message success';
                    document.getElementById('add-news-form').reset();
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Не удалось добавить новость.');
                }
            } catch (error) {
                statusMessage.textContent = `Ошибка: ${error.message}`;
                statusMessage.className = 'status-message error';
            } finally {
                statusMessage.style.display = 'block';
                setTimeout(() => statusMessage.style.display = 'none', 5000);
            }
        });
    </script>
</body>
</html>
